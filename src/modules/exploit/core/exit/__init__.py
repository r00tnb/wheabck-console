r'''Exit app.
'''

from api.exploit import Exploit, Cmdline
from api import MainSession, utils
from api.webshell import WebshellSession
import argparse

class exploit(Exploit):
    def __init__(self):
        self.parse = argparse.ArgumentParser(prog='exit', description='Exit app.')
        self.parse.add_argument('-f', '--force', help="Exit without confirmation.", action='store_true')
        self.help = __doc__ + self.parse.format_help()

    def support(self, session)-> bool:
        '''判断当前命令是否支持指定的session， 一般来说session即为运行改命令时的session
        '''
        self.session = session
        return True

    def run(self, args: Cmdline)-> int:
        args = self.parse.parse_args(args.options)
        if args.force:
            if isinstance(self.session, WebshellSession):
                self.session.exec(Cmdline(f"sessions -k {self.session.id} -f"))
                return self.SUCCESS
            else:
                return self.EXIT
        if utils.input("Are you sure to exit? (y/n) ").lower() == 'y':
            return self.EXIT
        return self.SUCCESS