<?php
$ret = array('code'=>-2, 'msg'=>'');
if(function_exists('oci_connect')){
    $des = "(DESCRPTION=(ADDRESS=(PROTOCOL=TCP)(HOST={$host})(PORT={$port}))(CONNECT_DATA =(SID={$database})))";
    $conn = @oci_connect($user, $passwrod, $des, 'UTF8');
    if(!$conn){
        $ret['code'] = -1;
        $ret['msg'] = 'Connect failed: '.print_r(oci_error(), true);
        $ret['msg'] = base64_encode($ret['msg']);
    }else{
        $r = oci_parse($conn, $sql);
        if($r === false){
            $ret['code'] = 0;
            $ret['msg'] = 'Query failed: '.print_r(oci_error($r), true);
            $ret['msg'] = base64_encode($ret['msg']);
        }else{
            $b = oci_execute($r);
            if($b){
                if(oci_num_fields($r)){
                    $ret['result'] = array();
                    while($row=oci_fetch_assoc($r)){
                        $tmp = array();
                        foreach($row as $key=>$val){
                            $tmp[base64_encode($key)] = base64_encode($val);
                        }
                        $ret['result'][] = $tmp;
                    }
                    $ret['code'] = 1;
                }else{
                    $ret['code'] = 2;
                    $ret['affected'] = oci_num_rows($r);
                }
                oci_free_statement($r);
            }else{
                $ret['code'] = 0;
                $ret['msg'] = 'Query failed: '.print_r(oci_error($r), true);
                $ret['msg'] = base64_encode($ret['msg']);
            }
        }
        oci_close($conn);
    }
}
echo json_encode($ret);