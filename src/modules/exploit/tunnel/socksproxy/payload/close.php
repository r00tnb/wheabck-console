<?php
//global: $shost, $sport, $sockid
$ret = array('code'=>-1, 'msg'=>'');
if(($sock = socket_create(AF_INET, SOCK_DGRAM, SOL_UDP))!==false){
    socket_set_option($sock,SOL_SOCKET,SO_RCVTIMEO,array("sec"=> 3, "usec"=> 0));
    $buf = pack('CCn', 4, $sockid, 0);
    if(socket_sendto($sock, $buf, strlen($buf), 0, $shost, $sport)!==false){
        if(socket_recvfrom($sock, $recvbuf, 3, 0, $shost, $sport)!==false){
            $code = unpack('C', substr($recvbuf, 0, 1))[1];
            if($code == 0){
                $ret['code'] = 1;
            }else{
                $ret['code'] = -2;
                $ret['msg'] = $code;
            }
        }
    }
}
if($ret['code'] === -1){
    $ret['msg'] = base64_encode(socket_strerror(socket_last_error()));
}
echo json_encode($ret);